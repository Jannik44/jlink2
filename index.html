<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Jlink link shortener</title>
    <link rel="stylesheet" href="assets/bootstrap.min.css">
</head>

<body>
    <section class="position-relative py-4 py-xl-5">
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7 col-xxl-6">
                    <div class="card mb-5">
                        <div class="card-body p-sm-5">
                            <!--?php echo $successalert; ?-->
                            <form class="mb-2" id="form">
                                <h1 class="text-center mb-4">
                                    Create a short link
                                </h1>
                                <div id="urlalert" style="display: none;" class="alert alert-danger" role="alert">
                                    $urlalert</div>
                                <div class="mb-3"><input class="form-control form-control-lg" type="url" id="url"
                                        placeholder="URL"></div>
                                <div class="mb-3"><input class="form-control form-control-lg" type="text" id="slug"
                                        placeholder="Custom Slug (optional)"></div>
                                <p class="fs-6 text"><b>Advanced settings</b></p>
                                <hr>
                                <!--?php echo $expalert; ?-->
                                <label for="expires">Expires (optional)</label>
                                <div class="mb-3"><input class="form-control" type="date" id="exp"
                                        placeholder="expires (optional)"></div>
                                <div class="mb-3"><input class="form-control" type="text" id="title"
                                        placeholder="Custom Link preview title (optional)"></div>
                                <div class="mb-3"><label for="desc" class="form-label">Custom
                                        link preview description (optional)</label>
                                    <textarea class="form-control" id="desc" rows="3"></textarea>
                                </div>
                                <div class="mb-3"></div>
                                <div><button id="createbutton" class="btn btn-primary d-block w-100"
                                        type="button">Create</button></div>
                            </form>
                            <div id="resultwrapper">
                                <h1 class="text-center mb-4">
                                    Your Result
                                </h1>
                                <div class='alert alert-success text-center' role='alert'>Link saved! Your short link
                                    is: <a id="resultlink"
                                        href='$http-or-https://$domain/$slug'>$http-or-https://$domain/$slug</a>
                                    <span id='copylbutton'>
                                        <button type='button' id=copylbutton class='btn btn-secondary mx-4'>
                                            <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24'
                                                fill='currentColor' class='bi bi-clipboard-plus-fill'
                                                viewBox='0 0 16 16'>
                                                <path
                                                    d='M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z'>
                                                </path>
                                                <path
                                                    d='M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5zm4.5 6V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5a.5.5 0 0 1 1 0'>
                                                </path>
                                            </svg>
                                        </button>
                                    </span>
                                </div>
                                <div class='text-center'>
                                    <a class='btn btn-success' href='/'>Create another link</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="fw-lighter">Jlink version 2.0 made by <a href="https://github.com/Jannik44">jannik44</a>
                    </p>
                </div>
            </div>
        </div>
    </section>
    <script>
        let finalurl = "";
        document.addEventListener('DOMContentLoaded', () => {
            const createButton = document.getElementById('createbutton');
            createButton.addEventListener('click', create);
            const copyButton = document.getElementById('copylbutton');
            copyButton.addEventListener('click', copyText);
            document.getElementById("urlalert").style.display = "none";
            document.getElementById("resultwrapper").style.display = "none";
        });
        function create() {
            let url = document.getElementById("url").value;
            let slug = document.getElementById("slug").value;
            let exp = document.getElementById("exp").value;
            let title = document.getElementById("title").value;
            let desc = document.getElementById("desc").value;
            console.log(url, slug, exp, title, desc);
            // Validate URL
            if (!url || url == "" || !isValidURL(url)) {
                console.log("URL is empty or invalid");
                document.getElementById("urlalert").style.display = "block";
                document.getElementById("urlalert").innerHTML = "Please enter a valid URL";
                return;
            } else {
                console.log("URL " + url + " is valid");
            }
            document.getElementById("urlalert").style.display = "none";
            // send data to create endpoint
            fetch('/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    url: url,
                    slug: slug,
                    exp: exp,
                    title: title,
                    desc: desc
                })
            })
                // handle response, if not 200 display error in urlalert
                .then(response => response.json())
                .then(data => {
                    if (data.finalurl) {
                        console.log("Link created successfully");
                        document.getElementById("urlalert").style.display = "none";
                        document.getElementById("form").style.display = "none";
                        document.getElementById("resultwrapper").style.display = "block";
                        document.getElementById("resultlink").href = data.finalurl;
                        document.getElementById("resultlink").innerHTML = data.finalurl;
                        finalurl = data.finalurl;
                        //document.getElementById("copylbutton").innerHTML = ""
                    } else {
                        document.getElementById("urlalert").style.display = "block";
                        document.getElementById("urlalert").innerHTML = data.error;
                        // extract error message from json response
                        console.error("Error creating link:", data.error);
                    }
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }
        function isValidURL(str) {
            try {
                new URL(str);
                return true;
            } catch (_) {
                return false;
            }
        }
        function copyText() {
            /* Copy text into clipboard */
            navigator.clipboard.writeText(finalurl)
                .then(() => {
                    document.getElementById('copylbutton').innerHTML = `
<button type='button' id='copylbutton' class='btn btn-success mx-4'>
    <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='currentColor' class='bi bi-clipboard-check-fill' viewBox='0 0 16 16'>
        <path d='M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z'/>
        <path d='M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708'/>
    </svg>
</button>
`;
                });
        }
    </script>
    <script src="assets/bootstrap.min.js"></script>
</body>

</html>